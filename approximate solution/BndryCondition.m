function X= BndryCondition( c_U,c_L,S,P )
X = zeros(6,1);
B = zeros(6,7);
I = zeros(3,3);
    for n = 1:7

        for i = 1:3
            for k = 1:3
                
                if (n<=3)   %refl P F S               equation(34)
                    I(n,4) =  (c_U(5,5)*(S(n,1)*P(n,3)+S(n,3)*P(n,1)) + c_U(4,5)*(S(n,2)*P(n,3)+S(n,3)*P(n,2)));
                    I(n,5) =  (c_U(4,5)*(S(n,1)*P(n,3)+S(n,3)*P(n,1)) + c_U(4,4)*(S(n,2)*P(n,3)+S(n,3)*P(n,2)));
                    I(n,6) =  (c_U(1,3)*S(n,1)*P(n,1) + c_U(2,3)*S(n,2)*P(n,2) + c_U(3,3)*S(n,3)*P(n,3) + c_U(3,6)*(S(n,1)*P(n,2)+S(n,2)*P(n,1)));
                
                elseif (n>=4 && n<=6)  %tran P F S
                    I(n,4) =  - (c_L(5,5)*(S(n,1)*P(n,3)+S(n,3)*P(n,1)) + c_L(4,5)*(S(n,2)*P(n,3)+S(n,3)*P(n,2)));
                    I(n,5) =  - (c_L(4,5)*(S(n,1)*P(n,3)+S(n,3)*P(n,1)) + c_L(4,4)*(S(n,2)*P(n,3)+S(n,3)*P(n,2)));
                    I(n,6) =  - (c_L(1,3)*S(n,1)*P(n,1) + c_L(2,3)*S(n,2)*P(n,2) + c_L(3,3)*S(n,3)*P(n,3) + c_L(3,6)*(S(n,1)*P(n,2)+S(n,2)*P(n,1)));
                
                elseif (n==7) %inc
                    I(n,4) =  (c_U(5,5)*(S(n,1)*P(n,3)+S(n,3)*P(n,1)) + c_U(4,5)*(S(n,2)*P(n,3)+S(n,3)*P(n,2)));
                    I(n,5) =  (c_U(4,5)*(S(n,1)*P(n,3)+S(n,3)*P(n,1)) + c_U(4,4)*(S(n,2)*P(n,3)+S(n,3)*P(n,2)));
                    I(n,6) =  (c_U(1,3)*S(n,1)*P(n,1) + c_U(2,3)*S(n,2)*P(n,2) + c_U(3,3)*S(n,3)*P(n,3) + c_U(3,6)*(S(n,1)*P(n,2)+S(n,2)*P(n,1)));
                
                end
                
            end
        end
        
    end

B(1,1)=P(1,1); B(1,2)=P(2,1); B(1,3)=P(3,1); B(1,4)=-P(4,1); B(1,5)=-P(5,1); B(1,6)=-P(6,1); B(1,7)=P(7,1); 
 
if (B(1,7)==0 && B(2,7)==0 && B(4,7)==0 && B(5,7)==0)
    X(1) = (B(3,7)*B(6,4) - B(6,7)*B(3,4)) / (B(3,4)*B(6,1) - B(6,4)*B(3,1));
    X(2) = 0;
    X(3) = 0;
    X(4) = (B(6,7)*B(3,1) - B(3,7)*B(6,1)) / (B(3,4)*B(6,1) - B(6,4)*B(3,1));
    X(5) = 0;
    X(6) = 0;
    
else

B(2,2)=P(2,2) - (P(1,2)*P(2,1))/P(1,1);           %Appendix B
B(2,3)=P(3,2) - (P(1,2)*P(3,1))/P(1,1);
B(2,4)=(P(1,2)*P(4,1))/P(1,1) - P(4,2);
B(2,5)=(P(1,2)*P(5,1))/P(1,1) - P(5,2);
B(2,6)=(P(1,2)*P(6,1))/P(1,1) - P(6,2);
B(2,7)=P(7,2) - (P(1,2)*P(7,1))/P(1,1);

A3=((I(2,4) - (I(1,4)*P(2,1))/P(1,1))*B(2,3)) / B(2,2) - I(3,4) + (I(1,4)*P(3,1))/P(1,1);
A4= -((I(2,4) - (I(1,4)*P(2,1))/P(1,1))*B(2,4)) / B(2,2) + I(4,4) + (I(1,4)*P(4,1))/P(1,1);
A5= -((I(2,4) - (I(1,4)*P(2,1))/P(1,1))*B(2,5)) / B(2,2) + I(5,4) + (I(1,4)*P(5,1))/P(1,1);
A6= -((I(2,4) - (I(1,4)*P(2,1))/P(1,1))*B(2,6)) / B(2,2) + I(6,4) + (I(1,4)*P(6,1))/P(1,1);
A7= -((I(2,4) - (I(1,4)*P(2,1))/P(1,1))*B(2,7)) / B(2,2) + I(7,4) - (I(1,4)*P(7,1))/P(1,1);

B3=((I(2,5) - (I(1,5)*P(2,1))/P(1,1))*B(2,3)) / B(2,2) - I(3,5) + (I(1,5)*P(3,1))/P(1,1);
B4= -((I(2,5) - (I(1,5)*P(2,1))/P(1,1))*B(2,4)) / B(2,2) + I(4,5) + (I(1,5)*P(4,1))/P(1,1);
B5= -((I(2,5) - (I(1,5)*P(2,1))/P(1,1))*B(2,5)) / B(2,2) + I(5,5) + (I(1,5)*P(5,1))/P(1,1);
B6= -((I(2,5) - (I(1,5)*P(2,1))/P(1,1))*B(2,6)) / B(2,2) + I(6,5) + (I(1,5)*P(6,1))/P(1,1);
B7= -((I(2,5) - (I(1,5)*P(2,1))/P(1,1))*B(2,7)) / B(2,2) + I(7,5) - (I(1,5)*P(7,1))/P(1,1);

E3=((I(2,6) - (I(1,6)*P(2,1))/P(1,1))*B(2,3)) / B(2,2) - I(3,6) + (I(1,6)*P(3,1))/P(1,1);
E4= -((I(2,6) - (I(1,6)*P(2,1))/P(1,1))*B(2,4)) / B(2,2) + I(4,6) + (I(1,6)*P(4,1))/P(1,1);
E5= -((I(2,6) - (I(1,6)*P(2,1))/P(1,1))*B(2,5)) / B(2,2) + I(5,6) + (I(1,6)*P(5,1))/P(1,1);
E6= -((I(2,6) - (I(1,6)*P(2,1))/P(1,1))*B(2,6)) / B(2,2) + I(6,6) + (I(1,6)*P(6,1))/P(1,1);
E7= -((I(2,6) - (I(1,6)*P(2,1))/P(1,1))*B(2,7)) / B(2,2) + I(7,6) - (I(1,6)*P(7,1))/P(1,1);

B(3,3)=P(3,3) - (P(1,3)*P(3,1))/P(1,1) - ((P(2,3) - (P(1,3)*P(2,1))/P(1,1))*B(2,3))/B(2,2);
B(3,4)=(P(1,3)*P(4,1))/P(1,1) - P(4,3) - ((P(2,3) - (P(1,3)*P(2,1))/P(1,1))*B(2,4))/B(2,2);
B(3,5)=(P(1,3)*P(5,1))/P(1,1) - P(5,3) - ((P(2,3) - (P(1,3)*P(2,1))/P(1,1))*B(2,5))/B(2,2);
B(3,6)=(P(1,3)*P(6,1))/P(1,1) - P(6,3) - ((P(2,3) - (P(1,3)*P(2,1))/P(1,1))*B(2,6))/B(2,2);
B(3,7)=P(7,3) - (P(1,3)*P(7,1))/P(1,1) - ((P(2,3) - (P(1,3)*P(2,1))/P(1,1))*B(2,7))/B(2,2);

B(4,4)= A4 + A3*B(3,4) / B(3,3);
B(4,5)= A5 + A3*B(3,5) / B(3,3);
B(4,6)= A6 + A3*B(3,6) / B(3,3);
B(4,7)= A7 + A3*B(3,7) / B(3,3);

B(5,5)= B5 - (B4+B(3,4)*B3/B(3,3))*B(4,5) / B(4,4) + B3*B(3,5)/B(3,3);
B(5,6)= B6 - (B4+B(3,4)*B3/B(3,3))*B(4,6) / B(4,4) + B3*B(3,6)/B(3,3);
B(5,7)= B7 - (B4+B(3,4)*B3/B(3,3))*B(4,7) / B(4,4) + B3*B(3,7)/B(3,3);

B(6,6)= E6 - (E5 - (E4+B(3,4)*E3/B(3,3))*B(4,5)/B(4,4) + E3*B(3,5)/B(3,3))*B(5,6) / (B5 - (B4+B(3,4)*B3/B(3,3))*B(4,5) / B(4,4) + B3*B(3,5)/B(3,3)) - (E4+B(3,4)*E3/B(3,3))*B(4,6) / B(4,4) + E3*B(3,6)/B(3,3);
B(6,7)= E7 - (E5 - (E4+B(3,4)*E3/B(3,3))*B(4,5)/B(4,4) + E3*B(3,5)/B(3,3))*B(5,7) / (B5 - (B4+B(3,4)*B3/B(3,3))*B(4,5) / B(4,4) + B3*B(3,5)/B(3,3)) - (E4+B(3,4)*E3/B(3,3))*B(4,7) / B(4,4) + E3*B(3,7)/B(3,3);
  
Tps2= -B(6,7)/B(6,6);                          %equations (40-41£©
Tps1= -(B(5,7)+B(5,6)*Tps2)/B(5,5);
Tpp=  -(B(4,7)+B(4,6)*Tps2+B(4,5)*Tps1)/B(4,4);
Rps2= -(B(3,7)+B(3,6)*Tps2+B(3,5)*Tps1+B(3,4)*Tpp)/B(3,3);
Rps1= -(B(2,7)+B(2,6)*Tps2+B(2,5)*Tps1+B(2,4)*Tpp+B(2,3)*Rps2)/B(2,2);
Rpp=  -(B(1,7)+B(1,6)*Tps2+B(1,5)*Tps1+B(1,4)*Tpp+B(1,3)*Rps2+B(1,2)*Rps1)/B(1,1);
X(1)=Rpp;
X(2)=Rps1;
X(3)=Rps2;
X(4)=Tpp;
X(5)=Tps1;
X(6)=Tps2;
end
